<form name="updateForm" role="form" (ngSubmit)="save()" [formGroup]="updateForm">
  <div class="modal-header">
    <h4 class="modal-title" [hidden]="!isNew" jhiTranslate="taskManagement.modal.newHeader">Create new task</h4>
    <h4 class="modal-title" [hidden]="isNew">{{ 'taskManagement.modal.editHeader' | translate: { taskHeader: taskModel?.header } }}</h4>

    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-hidden="true" (click)="close()"></button>
  </div>
  <div class="modal-body">
    <jhi-alert-error></jhi-alert-error>

    <div class="form-group">
      <label class="form-control-label" for="header" jhiTranslate="taskManagement.fields.header">Header:</label>
      <input type="text" class="form-control" name="header" id="header" formControlName="header" />

      <div *ngIf="updateForm.get('header')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('header')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="creator" jhiTranslate="taskManagement.fields.creator">Creator:</label>
      <input type="text" class="form-control" name="creator" id="creator" formControlName="creator" />

      <div *ngIf="updateForm.get('creator')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('creator')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="organisationUnit" jhiTranslate="taskManagement.fields.organisationUnit"
        >Organisation unit:</label
      >
      <input type="text" class="form-control" name="organisationUnit" id="organisationUnit" formControlName="organisationUnit" />

      <div *ngIf="updateForm.get('organisationUnit')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('organisationUnit')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-check">
      <label class="form-check-label" for="privateTask">
        <input class="form-check-input" type="checkbox" name="privateTask" id="privateTask" formControlName="privateTask" />
        <span jhiTranslate="taskManagement.fields.privateTask">Private task</span>
      </label>
    </div>
    <!-- Opaque ID interpreter -->
    <div class="form-group">
      <p></p>
      <label class="form-control-label" for="id">Moodle-ID:</label>
      <div class="input-group mb-3">
        <input type="text" class="form-control" name="id" id="id" disabled #moodleId value="{{ createMoodleId(taskModel?.id) }}" />
        <!--        @schuetzk disabled copy button as not working properly -> content not copied and form closed with saving-->
        <!--        <div class="input-group-append">-->
        <!--          <button class="btn btn-outline-secondary" (click)="copyInputMessage(moodleId)" value="click to copy">Copy</button>-->
        <!--        </div>-->
      </div>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="taskDifficulty" jhiTranslate="taskManagement.fields.taskDifficulty">Task difficulty:</label>
      <select class="form-control" name="taskDifficulty" id="taskDifficulty" formControlName="taskDifficulty">
        <option value="" disabled>{{ 'taskManagement.difficultyPlaceholder' | translate }}</option>
        <option *ngFor="let difficulty of difficulties" [ngValue]="difficulty">{{ difficulty.text | translate }}</option>
      </select>
      <div *ngIf="updateForm.get('taskDifficulty')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('taskDifficulty')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="taskAssignmentType" jhiTranslate="taskManagement.fields.taskType">Task type:</label>
      <select
        class="form-control"
        name="taskAssignmentType"
        id="taskAssignmentType"
        formControlName="taskAssignmentType"
        (change)="taskTypeChanged()"
      >
        <option value="" disabled>{{ 'taskManagement.taskTypePlaceholder' | translate }}</option>
        <option *ngFor="let taskType of taskTypes" [ngValue]="taskType">{{ taskType.text | translate }}</option>
      </select>

      <div *ngIf="updateForm.get('taskAssignmentType')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('taskAssignmentType')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.BpmnTask.value">
      <label class="form-control-label" for="bpmnTestConfig" jhiTranslate="taskManagement.fields.bpmnCreateStatements"></label>
      <!--      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.sqlStatementsInfo' | translate }}" placement="right"></fa-icon>-->
      <ngx-monaco-editor [options]="editorOptions" id="bpmnTestConfig" formControlName="bpmnTestConfig"></ngx-monaco-editor>
    </div>
    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.RATask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.UmlTask.value
      "
    ></div>

    <!-- APRIORI element start -->
    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.RATask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.CalcTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.BpmnTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.PmTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.UmlTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.AprioriTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.NfTask.value
      "
    >
      <!-- APRIORI element end -->

      <label class="form-control-label" for="maxPoints" jhiTranslate="taskManagement.fields.maxPoints">Maximum Points:</label>
      <input
        type="number"
        min="0"
        step="1"
        class="form-control"
        name="maxPoints"
        id="maxPoints"
        formControlName="maxPoints"
        pattern="^[0-9]*$"
      />
      <div *ngIf="updateForm.get('maxPoints')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('maxPoints')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>

    <!-- APRIORI start -->
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.AprioriTask.value">
      <label class="form-control-label" for="aprioriDatasetId" jhiTranslate="taskManagement.fields.datasetApriori"
        >Apriori task configuration ID:
      </label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.datasetInfo' | translate }}" placement="right"></fa-icon>
      <input type="text" class="form-control" name="aprioriDatasetId" id="aprioriDatasetId" formControlName="aprioriDatasetId" />

      <button type="button" class="btn btn-primary" style="margin-top: 10px" (click)="getAprioriLink()">
        <span jhiTranslate="taskManagement.fields.create">Create dataset and task config</span>
      </button>

      <button type="button" class="btn btn-primary" style="margin-top: 10px" (click)="getAprioriLinkTable()">
        <span jhiTranslate="taskManagement.fields.load">Load dataset and task config</span>
      </button>

      <p jhiTranslate="taskManagement.fields.taskIdApriori">
        Please copy the task configuration id from the extension and paste it into the field
      </p>
      <div *ngIf="updateForm.get('aprioriDatasetId')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('aprioriDatasetId')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <!-- APRIORI end  -->

    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.RATask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.PmTask.value ||
        selectedTaskAssignmentType === TaskAssignmentType.UmlTask.value
      "
    >
      <label class="form-control-label" for="diagnoseLevelWeighting">
        {{ 'taskManagement.fields.diagnoseLevelWeighting' | translate }}
        <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.diagnoseLevelWeightingInfo' | translate }}" placement="right"></fa-icon>
      </label>
      <input
        type="number"
        class="form-control"
        name="diagnoseLevelWeighting"
        id="diagnoseLevelWeighting"
        ngPattern="/^-?[0-9][^\.]*$/"
        formControlName="diagnoseLevelWeighting"
      />

      <div *ngIf="updateForm.get('diagnoseLevelWeighting')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('diagnoseLevelWeighting')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value || selectedTaskAssignmentType === TaskAssignmentType.RATask.value
      "
    >
      <label class="form-control-label" for="sqlCreateStatements" jhiTranslate="taskManagement.fields.sqlCreateStatements"
        >SQL Create-Table-Statements:</label
      >
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.sqlStatementsInfo' | translate }}" placement="right"></fa-icon>
      <ngx-monaco-editor
        [options]="editorOptionsReadOnly"
        id="sqlCreateStatements"
        formControlName="sqlCreateStatements"
      ></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value">
      <label class="form-control-label" for="xQueryDiagnoseXML" jhiTranslate="taskManagement.fields.xQueryDiagnoseXML"
        >XQuery: XML (Diagnose)</label
      >
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.xqueryXMLInfo' | translate }}" placement="right"></fa-icon>
      <ngx-monaco-editor
        [options]="editorOptionsXMLReadOnly"
        id="xQueryDiagnoseXML"
        formControlName="xQueryDiagnoseXML"
      ></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value">
      <label class="form-control-label" for="xQuerySubmissionXML" jhiTranslate="taskManagement.fields.xQuerySubmissionXML"
        >XQuery: XML (Submit)</label
      >
      <ngx-monaco-editor
        [options]="editorOptionsXMLReadOnly"
        id="xQuerySubmissionXML"
        formControlName="xQuerySubmissionXML"
      ></ngx-monaco-editor>
    </div>
    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value || selectedTaskAssignmentType === TaskAssignmentType.RATask.value
      "
    >
      <label
        class="form-control-label"
        for="sqlInsertStatementsSubmission"
        jhiTranslate="taskManagement.fields.sqlInsertStatementsSubmission"
        >SQL Insert-Into-Statements (Submission):</label
      >
      <ngx-monaco-editor
        [options]="editorOptionsReadOnly"
        id="sqlInsertStatementsSubmission"
        formControlName="sqlInsertStatementsSubmission"
      ></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value">
      <label class="form-control-label" for="sqlInsertStatementsDiagnose" jhiTranslate="taskManagement.fields.sqlInsertStatementsDiagnose"
        >SQL Insert-Into-Statements (Diagnose):</label
      >
      <ngx-monaco-editor
        [options]="editorOptionsReadOnly"
        id="sqlInsertStatementsDiagnose"
        formControlName="sqlInsertStatementsDiagnose"
      ></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value">
      <label class="form-control-label" for="datalogFacts" jhiTranslate="taskManagement.fields.datalogFacts">Datalog Facts</label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.datalogFactsInfo' | translate }}" placement="right"></fa-icon>
      <ngx-monaco-editor [options]="editorOptionsDLGReadOnly" id="datalogFacts" formControlName="datalogFacts"></ngx-monaco-editor>
    </div>

    <div
      class="form-group"
      *ngIf="
        selectedTaskAssignmentType === TaskAssignmentType.SQLTask.value || selectedTaskAssignmentType === TaskAssignmentType.RATask.value
      "
    >
      <label class="form-control-label" for="sqlSolution" jhiTranslate="taskManagement.fields.sqlSolution">SQL solution:</label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.trySolutionInfo' | translate }}" placement="right"></fa-icon>
      <br />
      <button type="button" class="btn btn-secondary" *ngIf="!isNew" (click)="openSolutionRunnerWindow()">Try</button>
      <button
        type="button"
        class="btn btn-secondary"
        *ngIf="!isNew && selectedTaskAssignmentType === TaskAssignmentType.RATask.value"
        (click)="openSolutionRunnerWindow(true)"
      >
        Try - SQL
      </button>
      <ngx-monaco-editor [options]="editorOptions" id="sqlSolution" formControlName="sqlSolution"></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value">
      <label class="form-control-label" for="xQuerySolution" jhiTranslate="taskManagement.fields.xQuerySolution">XQuery Solution:</label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.trySolutionInfo' | translate }}" placement="right"></fa-icon>
      <br />
      <button type="button" class="btn btn-secondary" *ngIf="!isNew" (click)="openSolutionRunnerWindow()">Try</button>
      <ngx-monaco-editor [options]="editorOptionsXQ" id="xQuerySolution" formControlName="xQuerySolution"></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value">
      <label class="form-control-label" for="xQueryXPathSorting" jhiTranslate="taskManagement.fields.xQuerySorting"
        >XQuery: XPath sorting</label
      >
      <ngx-monaco-editor [options]="editorOptions" id="xQueryXPathSorting" formControlName="xQueryXPathSorting"></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value">
      <label class="form-control-label" for="datalogSolution" jhiTranslate="taskManagement.fields.datalogSolution">Datalog: Solution</label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.datalogSolutionInfo' | translate }}" placement="right"></fa-icon>
      <br />
      <button type="button" class="btn btn-secondary" *ngIf="!isNew" (click)="openSolutionRunnerWindow()">Try</button>
      <ngx-monaco-editor [options]="editorOptionsDLG" id="datalogSolution" formControlName="datalogSolution"></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value">
      <label class="form-control-label" for="datalogQuery" jhiTranslate="taskManagement.fields.datalogQuery"> Datalog: Query </label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.datalogQueryInfo' | translate }}" placement="right"></fa-icon>
      <ngx-monaco-editor [options]="editorOptionsDLG" id="datalogQuery" formControlName="datalogQuery"></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.DatalogTask.value">
      <label class="form-control-label" for="datalogUncheckedTerms" jhiTranslate="taskManagement.fields.datalogUncheckedTerms"
        >Datalog: Unchecked Terms</label
      >
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.datalogUncheckedTermInfo' | translate }}" placement="right"></fa-icon>
      <ngx-monaco-editor
        [options]="editorOptionsDLG"
        id="datalogUncheckedTerms"
        formControlName="datalogUncheckedTerms"
      ></ngx-monaco-editor>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.XQueryTask.value">
      <label class="form-control-label" for="processingTime" jhiTranslate="taskManagement.fields.xQueryFileURL">XQuery- file url:</label>
      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.xqFileUrlInfo' | translate }}" placement="right"></fa-icon>
      <input type="text" [disabled]="true" class="form-control" name="xQueryFileURL" id="xQueryFileURL" formControlName="xQueryFileURL" />
    </div>

    <!-- PM Task Input -->
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.PmTask.value">
      <label class="form-control-label" for="maxActivity" jhiTranslate="taskManagement.fields.maxActivity"
        >Maximal Activity per Trace:</label
      >
      <input type="number" class="form-control" name="maxActivity" id="maxActivity" formControlName="maxActivity" />
      <div *ngIf="updateForm.get('maxActivity')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('maxActivity')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.PmTask.value">
      <label class="form-control-label" for="minActivity" jhiTranslate="taskManagement.fields.minActivity"
        >Minimal Activity per Trace:</label
      >
      <input type="number" class="form-control" name="minActivity" id="minActivity" formControlName="minActivity" />
      <div *ngIf="updateForm.get('minActivity')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('minActivity')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.PmTask.value">
      <label class="form-control-label" for="maxLogSize" jhiTranslate="taskManagement.fields.maxLogSize"
        >Maximal Log Size (Number of Traces):</label
      >
      <input type="number" class="form-control" name="maxLogSize" id="maxLogSize" formControlName="maxLogSize" />
      <div *ngIf="updateForm.get('maxLogSize')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('maxLogSize')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.PmTask.value">
      <label class="form-control-label" for="minLogSize" jhiTranslate="taskManagement.fields.minLogSize"
        >Minimal Log Size (Number of Traces):</label
      >
      <input type="number" class="form-control" name="minLogSize" id="minLogSize" formControlName="minLogSize" />
      <div *ngIf="updateForm.get('minLogSize')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('minLogSize')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>
    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.PmTask.value">
      <label class="form-control-label" for="configNum" jhiTranslate="taskManagement.fields.configNum"
        >Configuration Number (e.g. config1):</label
      >
      <input type="String" class="form-control" name="configNum" id="configNum" formControlName="configNum" />
      <div *ngIf="updateForm.get('configNum')!.invalid">
        <small
          class="form-text text-danger"
          *ngIf="updateForm.get('configNum')?.errors?.required"
          jhiTranslate="taskManagement.error.required"
        >
          This field is required!
        </small>
      </div>
    </div>

    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.CalcTask.value">
      <label class="form-control-label" for="calcInstructionFileUpload">Upload Instruction Writer: </label>
      <jhi-file-upload
        id="writerInstructionFileUpload"
        [fileId]="writerInstructionFileId"
        (fileAdded)="handleWriterInstructionFileAdded($event)"
        (fileRemoved)="handleWriterInstructionFileRemoved($event)"
        (fileModified)="handleWriterInstructionFileMoved($event[0], $event[1])"
      >
      </jhi-file-upload>
      <div *ngIf="writerInstructionFileId == -2">
        <small class="form-text text-danger" jhiTranslate="taskManagement.error.contentType">
          Please upload the correct content type of the file!
        </small>
      </div>
      <br />
      <label class="form-control-label" for="calcInstructionFileUpload">Upload Instruction Calc: </label>
      <jhi-file-upload
        id="calcInstructionFileUpload"
        [fileId]="calcInstructionFileId"
        (fileAdded)="handleCalcInstructionFileAdded($event)"
        (fileRemoved)="handleCalcInstructionFileRemoved($event)"
        (fileModified)="handleCalcInstructionFileMoved($event[0], $event[1])"
      >
      </jhi-file-upload>
      <div *ngIf="calcInstructionFileId == -2">
        <small class="form-text text-danger" jhiTranslate="taskManagement.error.contentType">
          Please upload the correct content type of the file!
        </small>
      </div>

      <br />
      <label class="form-control-label" for="calcSolutionFileUpload">Upload Solution Calc: </label>
      <jhi-file-upload
        id="calcSolutionFileUpload"
        [fileId]="calcSolutionFileId"
        (fileAdded)="handleCalcSolutionFileAdded($event)"
        (fileRemoved)="handleCalcSolutionFileRemoved($event)"
        (fileModified)="handleCalcSolutionFileMoved($event[0], $event[1])"
      >
      </jhi-file-upload>
      <div *ngIf="calcSolutionFileId == -2">
        <small class="form-text text-danger" jhiTranslate="taskManagement.error.contentType">
          Please upload the correct content type of the file!
        </small>
      </div>
    </div>

    <div class="form-group" *ngIf="selectedTaskAssignmentType === TaskAssignmentType.NfTask.value">
      <label class="form-control-label" for="nfBaseRelationAttributes" jhiTranslate="taskManagement.fields.baseRelationAttributes">
        Attributes of base relation:
      </label>
      <input
        type="text"
        class="form-control"
        name="nfBaseRelationAttributes"
        id="nfBaseRelationAttributes"
        formControlName="nfBaseRelationAttributes"
      />

      <label class="form-control-label" for="nfBaseRelationDependencies" jhiTranslate="taskManagement.fields.baseRelationDependencies">
        Functional dependencies of base relation:
      </label>
      <input
        type="text"
        class="form-control"
        name="nfBaseRelationDependencies"
        id="nfBaseRelationDependencies"
        formControlName="nfBaseRelationDependencies"
      />

      <label class="form-control-label" for="nfTaskSubtype" jhiTranslate="taskManagement.fields.nfTaskSubtype">NF task subtype:</label>
      <select
        class="form-control"
        name="nfTaskSubtype"
        id="nfTaskSubtype"
        formControlName="nfTaskSubtype"
        (change)="nfTaskSubtypeChanged()"
      >
        <option *ngFor="let nfTaskSubtype of nfTaskSubtypes" [ngValue]="nfTaskSubtype">{{ nfTaskSubtype.text | translate }}</option>
      </select>

      <div class="form-group" *ngIf="selectedNfTaskSubtype === NFTaskSubtype.KeysDeterminationTask.value">
        <label
          class="form-control-label"
          for="nfKeysDeterminationPenaltyPerMissingKey"
          jhiTranslate="taskManagement.fields.nfKeysDeterminationPenaltyPerMissingKey"
        >
          Points deducted per missing key:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfKeysDeterminationPenaltyPerMissingKey"
          id="nfKeysDeterminationPenaltyPerMissingKey"
          formControlName="nfKeysDeterminationPenaltyPerMissingKey"
        />

        <label
          class="form-control-label"
          for="nfKeysDeterminationPenaltyPerIncorrectKey"
          jhiTranslate="taskManagement.fields.nfKeysDeterminationPenaltyPerIncorrectKey"
        >
          Points deducted per missing key:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfKeysDeterminationPenaltyPerIncorrectKey"
          id="nfKeysDeterminationPenaltyPerIncorrectKey"
          formControlName="nfKeysDeterminationPenaltyPerIncorrectKey"
        />
      </div>

      <div class="form-group" *ngIf="selectedNfTaskSubtype === NFTaskSubtype.AttributeClosureTask.value">
        <label
          class="form-control-label"
          for="nfAttributeClosureBaseAttributes"
          jhiTranslate="taskManagement.fields.nfAttributeClosureBaseAttributes"
        >
          Base attributes for attribute closure:
        </label>
        <input
          type="text"
          class="form-control"
          name="nfAttributeClosureBaseAttributes"
          id="nfAttributeClosureBaseAttributes"
          formControlName="nfAttributeClosureBaseAttributes"
        />

        <label
          class="form-control-label"
          for="nfAttributeClosurePenaltyPerMissingAttribute"
          jhiTranslate="taskManagement.fields.nfAttributeClosurePenaltyPerMissingAttribute"
        >
          Points deducted per missing attribute:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfAttributeClosurePenaltyPerMissingAttribute"
          id="nfAttributeClosurePenaltyPerMissingAttribute"
          formControlName="nfAttributeClosurePenaltyPerMissingAttribute"
        />

        <label
          class="form-control-label"
          for="nfAttributeClosurePenaltyPerIncorrectAttribute"
          jhiTranslate="taskManagement.fields.nfAttributeClosurePenaltyPerIncorrectAttribute"
        >
          Points deducted per incorrect attribute:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfAttributeClosurePenaltyPerIncorrectAttribute"
          id="nfAttributeClosurePenaltyPerIncorrectAttribute"
          formControlName="nfAttributeClosurePenaltyPerIncorrectAttribute"
        />
      </div>

      <div class="form-group" *ngIf="selectedNfTaskSubtype === NFTaskSubtype.MinimalCoverTask.value">
        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerNonCanonicalDependency"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerNonCanonicalDependency"
        >
          Points deducted per non-canonical functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerNonCanonicalDependency"
          id="nfMinimalCoverPenaltyPerNonCanonicalDependency"
          formControlName="nfMinimalCoverPenaltyPerNonCanonicalDependency"
        />

        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerTrivialDependency"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerTrivialDependency"
        >
          Points deducted per trivial functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerTrivialDependency"
          id="nfMinimalCoverPenaltyPerTrivialDependency"
          formControlName="nfMinimalCoverPenaltyPerTrivialDependency"
        />

        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerExtraneousAttribute"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerExtraneousAttribute"
        >
          Points deducted per extraneous attribute on the left-hand side of a functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerExtraneousAttribute"
          id="nfMinimalCoverPenaltyPerExtraneousAttribute"
          formControlName="nfMinimalCoverPenaltyPerExtraneousAttribute"
        />

        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerRedundantDependency"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerRedundantDependency"
        >
          Points deducted per redundant functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerRedundantDependency"
          id="nfMinimalCoverPenaltyPerRedundantDependency"
          formControlName="nfMinimalCoverPenaltyPerRedundantDependency"
        />

        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerMissingDependencyVsSolution"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerMissingDependencyVsSolution"
        >
          Points deducted per missing dependency (as compared to the correct solution):
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerMissingDependencyVsSolution"
          id="nfMinimalCoverPenaltyPerMissingDependencyVsSolution"
          formControlName="nfMinimalCoverPenaltyPerMissingDependencyVsSolution"
        />

        <label
          class="form-control-label"
          for="nfMinimalCoverPenaltyPerIncorrectDependencyVsSolution"
          jhiTranslate="taskManagement.fields.nfMinimalCoverPenaltyPerIncorrectDependencyVsSolution"
        >
          Points deducted per incorrect dependency (as compared to the correct solution):
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfMinimalCoverPenaltyPerIncorrectDependencyVsSolution"
          id="nfMinimalCoverPenaltyPerIncorrectDependencyVsSolution"
          formControlName="nfMinimalCoverPenaltyPerIncorrectDependencyVsSolution"
        />
      </div>

      <div class="form-group" *ngIf="selectedNfTaskSubtype === NFTaskSubtype.NormalformDeterminationTask.value">
        <label
          class="form-control-label"
          for="nfNormalFormDeterminationPenaltyForIncorrectOverallNormalform"
          jhiTranslate="taskManagement.fields.nfNormalFormDeterminationPenaltyForIncorrectOverallNormalform"
        >
          Points deducted for incorrect normal form overall:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalFormDeterminationPenaltyForIncorrectOverallNormalform"
          id="nfNormalFormDeterminationPenaltyForIncorrectOverallNormalform"
          formControlName="nfNormalFormDeterminationPenaltyForIncorrectOverallNormalform"
        />

        <label
          class="form-control-label"
          for="nfNormalFormDeterminationPenaltyPerIncorrectDependencyNormalform"
          jhiTranslate="taskManagement.fields.nfNormalFormDeterminationPenaltyPerIncorrectDependencyNormalform"
        >
          Points deducted per incorrect normal form on a functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalFormDeterminationPenaltyPerIncorrectDependencyNormalform"
          id="nfNormalFormDeterminationPenaltyPerIncorrectDependencyNormalform"
          formControlName="nfNormalFormDeterminationPenaltyPerIncorrectDependencyNormalform"
        />
      </div>

      <div class="form-group" *ngIf="selectedNfTaskSubtype === NFTaskSubtype.NormalizationTask.value">
        <label class="form-control-label" for="nfNormalizationTargetLevel" jhiTranslate="taskManagement.fields.nfNormalizationTargetLevel">
          Target normal form:
        </label>
        <input
          type="text"
          class="form-control"
          name="nfNormalizationTargetLevel"
          id="nfNormalizationTargetLevel"
          formControlName="nfNormalizationTargetLevel"
        />

        <label
          class="form-control-label"
          for="nfNormalizationMaxLostDependencies"
          jhiTranslate="taskManagement.fields.nfNormalizationMaxLostDependencies"
        >
          Maximum number of lost functional dependencies:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationMaxLostDependencies"
          id="nfNormalizationMaxLostDependencies"
          formControlName="nfNormalizationMaxLostDependencies"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerLostAttribute"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerLostAttribute"
        >
          Points deducted per lost attribute of the base relation:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerLostAttribute"
          id="nfNormalizationPenaltyPerLostAttribute"
          formControlName="nfNormalizationPenaltyPerLostAttribute"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyForLossyDecomposition"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyForLossyDecomposition"
        >
          Points deducted for lossy decomposition:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyForLossyDecomposition"
          id="nfNormalizationPenaltyForLossyDecomposition"
          formControlName="nfNormalizationPenaltyForLossyDecomposition"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerNonCanonicalDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerNonCanonicalDependency"
        >
          Points deducted per non-canonical functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerNonCanonicalDependency"
          id="nfNormalizationPenaltyPerNonCanonicalDependency"
          formControlName="nfNormalizationPenaltyPerNonCanonicalDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerTrivialDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerTrivialDependency"
        >
          Points deducted per trivial functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerTrivialDependency"
          id="nfNormalizationPenaltyPerTrivialDependency"
          formControlName="nfNormalizationPenaltyPerTrivialDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerExtraneousAttributeInDependencies"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerExtraneousAttributeInDependencies"
        >
          Points deducted per extraneous attribute on the left-hand side of functional dependencies:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerExtraneousAttributeInDependencies"
          id="nfNormalizationPenaltyPerExtraneousAttributeInDependencies"
          formControlName="nfNormalizationPenaltyPerExtraneousAttributeInDependencies"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerRedundantDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerRedundantDependency"
        >
          Points deducted per redundant functional dependency:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerRedundantDependency"
          id="nfNormalizationPenaltyPerRedundantDependency"
          formControlName="nfNormalizationPenaltyPerRedundantDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerExcessiveLostDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerExcessiveLostDependency"
        >
          Points deducted per lost functional dependency above the allowed number:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerExcessiveLostDependency"
          id="nfNormalizationPenaltyPerExcessiveLostDependency"
          formControlName="nfNormalizationPenaltyPerExcessiveLostDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerMissingNewDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerMissingNewDependency"
        >
          Points deducted per functional dependency that is necessitated by decomposition yet missing:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerMissingNewDependency"
          id="nfNormalizationPenaltyPerMissingNewDependency"
          formControlName="nfNormalizationPenaltyPerMissingNewDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerIncorrectNewDependency"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerIncorrectNewDependency"
        >
          Points deducted per incorrect functional dependency present in the decomposed relations:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerIncorrectNewDependency"
          id="nfNormalizationPenaltyPerIncorrectNewDependency"
          formControlName="nfNormalizationPenaltyPerIncorrectNewDependency"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerMissingKey"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerMissingKey"
        >
          Points deducted per missing key in the decomposed relations:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerMissingKey"
          id="nfNormalizationPenaltyPerMissingKey"
          formControlName="nfNormalizationPenaltyPerMissingKey"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerIncorrectKey"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerIncorrectKey"
        >
          Points deducted per incorrect key in the decomposed relations:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerIncorrectKey"
          id="nfNormalizationPenaltyPerIncorrectKey"
          formControlName="nfNormalizationPenaltyPerIncorrectKey"
        />

        <label
          class="form-control-label"
          for="nfNormalizationPenaltyPerIncorrectNFRelation"
          jhiTranslate="taskManagement.fields.nfNormalizationPenaltyPerIncorrectNFRelation"
        >
          Points deducted per decomposed relation that is not in the correct normal form:
        </label>
        <input
          type="number"
          min="0"
          step="1"
          class="form-control"
          name="nfNormalizationPenaltyPerIncorrectNFRelation"
          id="nfNormalizationPenaltyPerIncorrectNFRelation"
          formControlName="nfNormalizationPenaltyPerIncorrectNFRelation"
        />
      </div>
    </div>

    <div class="form-group">
      <label class="form-control-label" for="processingTime" jhiTranslate="taskManagement.fields.processingTime">Processing time:</label>
      <input type="text" class="form-control" name="processingTime" id="processingTime" formControlName="processingTime" />
    </div>
    <div class="form-group">
      <label class="form-control-label" for="url" jhiTranslate="taskManagement.fields.url">Url:</label>
      <input type="url" class="form-control" name="url" id="url" formControlName="url" />

      <div *ngIf="updateForm.get('url')!.invalid">
        <small class="form-text text-danger" *ngIf="updateForm.get('url')?.errors?.pattern" jhiTranslate="taskManagement.error.urlPattern">
          This optional field has to conform the URL standard!
        </small>
      </div>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="instruction" jhiTranslate="taskManagement.fields.instruction">Instructions:</label>
      <quill-editor [placeholder]="''" id="instruction" formControlName="instruction"> </quill-editor>
    </div>
    <div class="form-group">
      <label class="form-control-label" for="taskGroup" jhiTranslate="taskManagement.fields.taskGroup">Task group:</label>
      <select class="form-control" name="taskGroup" (change)="taskGroupChanged()" id="taskGroup" formControlName="taskGroup">
        <option value="">{{ 'taskManagement.fields.taskGroupPlaceHolder' | translate }}</option>
        <option *ngFor="let group of taskGroups" [value]="group.id">{{ group.name }}</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-control-label" for="fileUpload">Upload: </label>
      <!--      <fa-icon icon="info-circle" ngbTooltip="{{ 'taskManagement.fileUploadInfo' | translate }}" placement="right"></fa-icon>-->
      <jhi-file-upload
        id="fileUpload"
        [fileId]="uploadFileId"
        (fileAdded)="handleFileAdded($event)"
        (fileRemoved)="handleFileRemoved($event)"
        (fileModified)="handleFileMoved($event[0], $event[1])"
      >
      </jhi-file-upload>
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="close()">
      <fa-icon icon="ban"></fa-icon>&nbsp;<span jhiTranslate="courseManagement.form.cancel">Cancel</span>
    </button>

    <ng-container *ngIf="selectedTaskAssignmentType === TaskAssignmentType.CalcTask.value">
      <button
        type="submit"
        [disabled]="
          updateForm.invalid ||
          isSaving ||
          writerInstructionFileId == -2 ||
          writerInstructionFileId == -1 ||
          calcSolutionFileId == -2 ||
          calcSolutionFileId == -1 ||
          calcInstructionFileId == -2 ||
          calcInstructionFileId == -1
        "
        class="btn btn-primary"
      >
        <span *ngIf="isSaving" class="spinner-border spinner-border-sm mr-1"></span>
        <fa-icon *ngIf="!isSaving" icon="save"></fa-icon>&nbsp;<span jhiTranslate="courseManagement.form.save">Save</span>
      </button>
    </ng-container>
    <ng-container *ngIf="selectedTaskAssignmentType !== TaskAssignmentType.CalcTask.value">
      <button type="submit" [disabled]="updateForm.invalid || isSaving" class="btn btn-primary">
        <span *ngIf="isSaving" class="spinner-border spinner-border-sm mr-1"></span>
        <fa-icon *ngIf="!isSaving" icon="save"></fa-icon>&nbsp;<span jhiTranslate="courseManagement.form.save">Save</span>
      </button>
    </ng-container>
  </div>
</form>
